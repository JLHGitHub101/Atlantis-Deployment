[Unit]
Description=Atlantis Terraform Pull Request Automation
After=network.target

[Service]
Type=simple
User={{ atlantis_user }}
Group={{ atlantis_group }}
WorkingDirectory={{ atlantis_data_dir }}
ExecStart=/usr/local/bin/atlantis server \
  --atlantis-url="http://$(curl -s http://169.254.169.254/latest/meta-data/public-ipv4):{{ atlantis_port }}" \
  --port={{ atlantis_port }} \
  --gh-user="{{ github_user }}" \
  --gh-token="{{ github_token }}" \
  --gh-webhook-secret="{{ github_webhook_secret }}" \
  --data-dir={{ atlantis_data_dir }} \
  --repo-allowlist='*'
Restart=on-failure
RestartSec=5

[Install]
WantedBy=multi-user.target
